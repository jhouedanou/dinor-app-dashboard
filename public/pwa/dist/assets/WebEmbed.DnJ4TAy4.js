import{d as e,e as o,t as a,f as r,r as l,m as n,u as t,C as s,p as u,h as c,o as d}from"./vendor.BeqKZlTx.js";import{a as i}from"./useApi.XzjE-Aek.js";import{_ as m}from"./index.C1mfdDgG.js";import"./api.DeptcIQc.js";const b={class:"web-embed"},g={class:"md3-main-content"},v={key:0,class:"error-state"},p={class:"md3-body-large dinor-text-gray"},f={class:"error-actions"},E={key:1,class:"iframe-container"},W={key:0,class:"loading-overlay"},L=["src"],y={key:2,class:"placeholder-container"};const h=m({name:"WebEmbed",setup(){const e=c(),o=t(),{request:a}=i(),r=l(null),d=l(!0),m=l(!1),b=l(""),g=l("Page Web"),v=l(null),p=l("");let f=null;const E=async()=>{try{console.log("üîÑ [WebEmbed] D√©but du chargement de la derni√®re page..."),d.value=!0,m.value=!1,console.log("üì° [WebEmbed] Appel API vers /pages/latest");const e=await a("/pages/latest");if(console.log("üìã [WebEmbed] R√©ponse API re√ßue:",e),!e.success||!e.data)throw console.error("‚ùå [WebEmbed] R√©ponse API invalide:",e),new Error(e.message||"Aucune page disponible");{v.value=e.data,g.value=e.data.title||"Page Web",console.log("üìÑ [WebEmbed] Page trouv√©e:",{title:e.data.title,url:e.data.url,embed_url:e.data.embed_url});let o=e.data.embed_url||e.data.url;if(console.log("üîó [WebEmbed] URL √† charger:",o),!o)throw console.error("‚ùå [WebEmbed] Aucune URL disponible dans les donn√©es"),new Error("Aucune URL disponible pour cette page");if(!h(o))return console.warn("‚ö†Ô∏è [WebEmbed] URL d√©tect√©e comme non-compatible iframe:",o),m.value=!0,d.value=!1,void(b.value='Cette page ne peut pas √™tre affich√©e en iframe. Cliquez sur "Ouvrir dans un nouvel onglet" pour l\'afficher.');p.value=o,console.log("üöÄ [WebEmbed] URL finale d√©finie:",p.value),await s(),d.value=!1,console.log("‚úÖ [WebEmbed] Loading arr√™t√© - iframe peut maintenant se rendre"),L()}}catch(e){console.error("üí• [WebEmbed] Erreur lors du chargement:",e),m.value=!0,b.value=e.message||"Erreur lors du chargement de la page",d.value=!1}},W=()=>{console.log("üîç [WebEmbed] V√©rification des query parameters...");const e=o.query.url;if(console.log("üìã [WebEmbed] URL du query parameter:",e),!e)return console.log("‚ùå [WebEmbed] Aucune URL dans les query parameters"),"";try{let o=decodeURIComponent(e);return console.log("üîì [WebEmbed] URL d√©cod√©e:",o),new URL(o),console.log("‚úÖ [WebEmbed] URL valide, pr√™te √† √™tre charg√©e"),console.log("üöÄ [WebEmbed] URL finale du query parameter:",o),o}catch(a){return console.error("üí• [WebEmbed] Erreur de validation URL:",a),m.value=!0,b.value="URL invalide fournie",""}},L=()=>{f&&(clearTimeout(f),console.log("‚è∞ [WebEmbed] Ancien timeout annul√©")),console.log("‚è±Ô∏è [WebEmbed] D√©marrage du timeout de 30 secondes"),f=setTimeout(()=>{!m.value&&p.value&&(console.error("‚è∞ [WebEmbed] Timeout atteint - iframe non charg√©e"),console.error("‚è∞ [WebEmbed] URL qui posait probl√®me:",p.value),d.value=!1,m.value=!0,b.value="D√©lai de chargement d√©pass√©. La page met trop de temps √† r√©pondre.")},3e4)},y=()=>{console.log("üîÑ [WebEmbed] Rafra√Æchissement de la page..."),r.value&&p.value?(console.log("üîÅ [WebEmbed] Rechargement de l'iframe avec URL:",p.value),d.value=!0,m.value=!1,L(),r.value.src=p.value):(console.log("üîÑ [WebEmbed] Rechargement via API"),E())};n(async()=>{console.log("üöÄ [WebEmbed] Composant mont√©, initialisation..."),console.log("üìç [WebEmbed] Route actuelle:",o.path),console.log("üîç [WebEmbed] Query parameters:",o.query);const e=W();if(e){if(console.log("üéØ [WebEmbed] Utilisation de l'URL du query parameter"),!h(e))return console.warn("‚ö†Ô∏è [WebEmbed] URL du query parameter non-compatible iframe:",e),m.value=!0,d.value=!1,void(b.value='Cette page ne peut pas √™tre affich√©e en iframe. Cliquez sur "Ouvrir dans un nouvel onglet" pour l\'afficher.');p.value=e,g.value="Page Web",console.log("üéØ [WebEmbed] URL d√©finie:",p.value),await s(),d.value=!1,console.log("‚úÖ [WebEmbed] Loading arr√™t√© - iframe peut se rendre"),L()}else console.log("üì° [WebEmbed] Aucune URL en query parameter, chargement via API..."),await E();setTimeout(async()=>{await s(),console.log("üîç [WebEmbed] √âtat final apr√®s nextTick:"),console.log("  - embedUrl:",p.value),console.log("  - loading:",d.value),console.log("  - error:",m.value),console.log("  - webFrame pr√©sent:",!!r.value),r.value&&console.log("  - iframe src:",r.value.src)},100)}),u(()=>{f&&(clearTimeout(f),console.log("üßπ [WebEmbed] Composant d√©mont√©, timeout nettoy√©"))});const h=e=>{const o=["youtube.com","youtu.be","facebook.com","instagram.com","twitter.com","x.com","tiktok.com"];try{const a=new URL(e),r=o.some(e=>a.hostname.includes(e));return r?console.warn("üö´ [WebEmbed] Domaine connu pour bloquer les iframes:",a.hostname):console.log("‚úÖ [WebEmbed] Domaine autoris√© pour iframe:",a.hostname),!r}catch{return!1}};return{webFrame:r,loading:d,error:m,errorMessage:b,pageTitle:g,embedUrl:p,currentPage:v,onIframeLoad:()=>{console.log("‚úÖ [WebEmbed] Iframe charg√©e avec succ√®s pour:",p.value),m.value=!1,f&&(clearTimeout(f),f=null,console.log("‚è∞ [WebEmbed] Timeout annul√© - iframe charg√©e"));try{if(r.value&&r.value.contentDocument){const e=r.value.contentDocument.title;e&&(console.log("üìñ [WebEmbed] Titre de la page r√©cup√©r√©:",e),g.value=e)}}catch(e){console.log("‚ö†Ô∏è [WebEmbed] Impossible de r√©cup√©rer le titre (politique CORS):",e.message)}},onIframeError:e=>{console.error("üí• [WebEmbed] Erreur de chargement de l'iframe pour:",p.value),console.error("üí• [WebEmbed] D√©tails de l'√©v√©nement:",e),console.log("üîç [WebEmbed] Causes possibles :"),console.log("   ‚Ä¢ Le site a X-Frame-Options: DENY/SAMEORIGIN"),console.log("   ‚Ä¢ URL inaccessible ou inexistante"),console.log("   ‚Ä¢ Probl√®me de r√©seau ou timeout"),console.log("   ‚Ä¢ Site n√©cessitant HTTPS"),console.log("   ‚Ä¢ Politique Content-Security-Policy restrictive"),f&&(clearTimeout(f),f=null,console.log("‚è∞ [WebEmbed] Timeout annul√© - erreur d√©tect√©e")),m.value=!0,b.value="Ce site bloque l'affichage en iframe. Utilisez \"Ouvrir dans un nouvel onglet\" pour l'afficher."},onIframeLoadStart:()=>{console.log("üöÄ [WebEmbed] D√©but du chargement de l'iframe")},onIframeLoadEnd:()=>{console.log("‚úÖ [WebEmbed] Fin du chargement de l'iframe")},refreshPage:y,retryLoad:()=>{y()},openInNewTab:()=>{const e=p.value||v.value&&(v.value.embed_url||v.value.url);e?(console.log("üîó [WebEmbed] Ouverture dans un nouvel onglet:",e),window.open(e,"_blank","noopener,noreferrer")):console.warn("‚ö†Ô∏è [WebEmbed] Aucune URL disponible pour ouvrir dans un nouvel onglet")},goBack:()=>{e.go(-1)},loadLatestPage:E,getUrlFromQuery:W,canLoadInIframe:h}}},[["render",function(l,n,t,s,u,c){return d(),e("div",b,[o("main",g,[s.error?(d(),e("div",v,[n[7]||(n[7]=o("div",{class:"error-icon"},[o("i",{class:"material-icons"},"error_outline")],-1)),n[8]||(n[8]=o("h2",{class:"md3-title-large"},"Erreur de chargement",-1)),o("p",p,a(s.errorMessage),1),o("div",f,[o("button",{onClick:n[0]||(n[0]=(...e)=>s.retryLoad&&s.retryLoad(...e)),class:"btn-primary"},"R√©essayer"),s.embedUrl||s.currentPage&&(s.currentPage.embed_url||s.currentPage.url)?(d(),e("button",{key:0,onClick:n[1]||(n[1]=(...e)=>s.openInNewTab&&s.openInNewTab(...e)),class:"btn-secondary"},"Ouvrir dans un nouvel onglet")):r("",!0),o("button",{onClick:n[2]||(n[2]=(...e)=>s.goBack&&s.goBack(...e)),class:"btn-secondary"},"Retour")])])):(d(),e("div",E,[s.loading?(d(),e("div",W,n[9]||(n[9]=[o("div",{class:"loading-content"},[o("div",{class:"md3-circular-progress"}),o("p",{class:"md3-body-large"},"Chargement de la page...")],-1)]))):r("",!0),s.embedUrl?(d(),e("iframe",{key:1,ref:"webFrame",src:s.embedUrl,class:"web-iframe",title:"Page Web Int√©gr√©e",frameborder:"0",allowfullscreen:"",onLoad:n[3]||(n[3]=(...e)=>s.onIframeLoad&&s.onIframeLoad(...e)),onError:n[4]||(n[4]=(...e)=>s.onIframeError&&s.onIframeError(...e)),onLoadstart:n[5]||(n[5]=(...e)=>s.onIframeLoadStart&&s.onIframeLoadStart(...e)),onLoadend:n[6]||(n[6]=(...e)=>s.onIframeLoadEnd&&s.onIframeLoadEnd(...e))},null,40,L)):(d(),e("div",y,n[10]||(n[10]=[o("div",{class:"md3-circular-progress"},null,-1),o("p",{class:"md3-body-large"},"Pr√©paration de la page...",-1)])))]))])])}],["__scopeId","data-v-e10666fe"]]);export{h as default};

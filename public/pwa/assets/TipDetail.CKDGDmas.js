import{e,f as t,v as a,g as s,i,l as o,t as l,F as r,m as n,B as d,D as m,r as c,b as u,h as p,k as v,u as y,o as g}from"./vendor.CgTKjNNK.js";import{_ as h,A as b,S as f,a as k,u as C,d as w}from"./index.DSySyJtv.js";import{u as _}from"./useComments.f2f6vNAY.js";import{B as x}from"./Badge.Bj4qGncG.js";const A={class:"tip-detail"},D={class:"md3-main-content"},S={key:0,class:"loading-container"},M={key:1,class:"tip-content"},E={key:0,class:"tip-hero"},j=["src","alt"],L={class:"tip-overlay dinor-gradient-primary"},T={class:"tip-badges"},$={class:"tip-info"},B={class:"tip-stats"},I={class:"stat-item"},F={class:"md3-body-medium"},V={class:"stat-item"},z={class:"md3-body-medium"},H={class:"stat-item"},U={class:"md3-body-medium"},R={key:0,class:"tip-summary-video"},q={class:"video-container"},P=["src","title"],G={class:"tip-content-text"},N=["innerHTML"],O={key:1,class:"tip-tags"},J={class:"tags-container"},K={class:"comments-section"},Q={class:"md3-title-medium dinor-text-primary"},W={class:"add-comment-form"},X={key:0,class:"auth-prompt"},Y={key:1},Z={class:"authenticated-user"},ee={class:"user-info"},te=["disabled"],ae={key:0,class:"comments-list"},se={class:"comment-header"},ie={class:"comment-meta"},oe={class:"comment-author md3-body-medium"},le={class:"comment-date md3-body-small dinor-text-gray"},re={key:0,class:"comment-actions"},ne=["onClick"],de={class:"comment-content md3-body-medium"},me={key:1,class:"empty-comments"},ce={key:2,class:"error-state"},ue={class:"error-actions"};const pe=h({name:"TipDetail",emits:["update-header"],components:{Badge:x,ShareModal:f,AuthModal:b},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=v();y();const s=k(),i=C(),{showShareModal:o,updateOpenGraphTags:l}=w(),{comments:r,loadComments:n,canDeleteComment:d,deleteComment:m,setContext:g,addComment:h}=_(),b=c(null),f=c(!0),x=c(!1),A=c(!1),D=c(""),S=c(!1),M=u(()=>b.value?{title:b.value.title,text:`DÃ©couvrez cette astuce pratique : ${b.value.title}`,url:window.location.href,image:b.value.image,type:"tip",id:b.value.id}:{}),E=async()=>{try{const t=await s.get("/likes/check",{type:"tip",id:e.id});x.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la vÃ©rification du like:",t)}},j=async()=>{try{const t=await s.get("/favorites/check",{type:"tip",id:e.id});A.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la vÃ©rification du favori:",t)}};return p(()=>{(async()=>{try{const a=await s.get(`/tips/${e.id}`);a.success&&(b.value=a.data,g("Tip",e.id),await n(),await E(),await j(),l(M.value),t("update-header",{title:b.value.title||"Astuce",showShare:!0,showFavorite:!0,favoriteType:"tip",favoriteItemId:parseInt(e.id),isContentFavorited:A.value,backPath:"/tips"}))}catch(a){console.error("Erreur lors du chargement de l'astuce:",a)}finally{f.value=!1}})()}),{tip:b,comments:r,loading:f,userLiked:x,userFavorited:A,newComment:D,toggleLike:async()=>{try{const a=await s.post("/likes/toggle",{likeable_type:"tip",likeable_id:e.id});a.success&&(x.value=!x.value,b.value&&(b.value.likes_count=a.data.total_likes),t("update-header",{isLiked:x.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await s.post("/favorites/toggle",{favoritable_type:"tip",favoritable_id:e.id});a.success&&(A.value=!A.value,b.value&&(b.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:A.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(D.value.trim())if(i.isAuthenticated)try{console.log("ðŸ“ [Comments] Envoi du commentaire pour Tip:",e.id),await h("Tip",e.id,D.value),console.log("âœ… [Comments] Commentaire ajoutÃ© avec succÃ¨s"),D.value=""}catch(t){console.error("âŒ [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connectÃ©"))&&(S.value=!0)}else S.value=!0},canDeleteComment:d,deleteComment:m,goBack:()=>{a.push("/tips")},goHome:()=>{a.push("/")},getDifficultyLabel:e=>({beginner:"DÃ©butant",intermediate:"IntermÃ©diaire",advanced:"AvancÃ©"}[e]||"DÃ©butant"),formatDate:e=>new Date(e).toLocaleDateString("fr-FR"),handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>Ã‰tape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",getEmbedUrl:e=>{if(!e||!e.trim())return"";const t=e.trim(),a=t.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);if(a)return`https://www.youtube.com/embed/${a[1]}?rel=0&modestbranding=1`;const s=t.match(/vimeo\.com\/(\d+)/);return s?`https://player.vimeo.com/video/${s[1]}`:t},showShareModal:o,shareData:M,authStore:i,showAuthModal:S}}},[["render",function(c,u,p,v,y,h){const b=o("Badge"),f=o("ShareModal"),k=o("AuthModal");return g(),e("div",A,[t("main",D,[v.loading?(g(),e("div",S,u[9]||(u[9]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'astuce...",-1)]))):v.tip?(g(),e("div",M,[v.tip.image_url?(g(),e("div",E,[t("img",{src:v.tip.image_url||"/images/default-recipe.jpg",alt:v.tip.title,class:"tip-hero-image",onError:u[0]||(u[0]=(...e)=>v.handleImageError&&v.handleImageError(...e))},null,40,j),t("div",L,[t("div",T,[v.tip.difficulty_level?(g(),i(b,{key:0,text:v.getDifficultyLabel(v.tip.difficulty_level),icon:"lightbulb",variant:"secondary",size:"medium"},null,8,["text"])):s("",!0),v.tip.category?(g(),i(b,{key:1,text:v.tip.category.name,icon:"tag",variant:"neutral",size:"medium"},null,8,["text"])):s("",!0)])])])):s("",!0),t("div",$,[t("div",B,[t("div",I,[u[10]||(u[10]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"schedule",-1)),t("span",F,l(v.tip.estimated_time)+"min",1)]),t("div",V,[u[11]||(u[11]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"favorite",-1)),t("span",z,l(v.tip.likes_count||0),1)]),t("div",H,[u[12]||(u[12]=t("span",{class:"material-symbols-outlined dinor-text-secondary"},"comment",-1)),t("span",U,l(v.tip.comments_count||0),1)])]),v.tip.summary_video_url&&v.tip.summary_video_url.trim()?(g(),e("div",R,[u[13]||(u[13]=t("h2",{class:"md3-title-medium dinor-text-primary"},"RÃ©sumÃ© en vidÃ©o",-1)),t("div",q,[t("iframe",{src:v.getEmbedUrl(v.tip.summary_video_url),title:`RÃ©sumÃ© vidÃ©o : ${v.tip.title}`,frameborder:"0",allowfullscreen:"",class:"summary-video-iframe"},null,8,P)])])):s("",!0),t("div",G,[u[14]||(u[14]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Astuce",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:v.formatContent(v.tip.content)},null,8,N)]),v.tip.tags&&v.tip.tags.length?(g(),e("div",O,[u[15]||(u[15]=t("h3",{class:"md3-title-small dinor-text-primary"},"Tags",-1)),t("div",J,[(g(!0),e(r,null,n(v.tip.tags,t=>(g(),e("span",{key:t,class:"md3-chip"},l(t),1))),128))])])):s("",!0),t("div",K,[t("h2",Q,"Commentaires ("+l(v.comments.length)+")",1),t("div",W,[v.authStore.isAuthenticated?(g(),e("div",Y,[t("div",Z,[t("span",ee,"ConnectÃ© en tant que "+l(v.authStore.userName),1),t("button",{onClick:u[2]||(u[2]=e=>v.authStore.logout()),class:"btn-logout"},"DÃ©connexion")]),d(t("textarea",{"onUpdate:modelValue":u[3]||(u[3]=e=>v.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[m,v.newComment]]),t("button",{onClick:u[4]||(u[4]=(...e)=>v.addComment&&v.addComment(...e)),class:"btn-primary",disabled:!v.newComment.trim()}," Publier ",8,te)])):(g(),e("div",X,[u[16]||(u[16]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:u[1]||(u[1]=e=>v.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),v.comments.length?(g(),e("div",ae,[(g(!0),e(r,null,n(v.comments,a=>(g(),e("div",{key:a.id,class:"comment-item"},[t("div",se,[t("div",ie,[t("span",oe,l(a.author_name),1),t("span",le,l(v.formatDate(a.created_at)),1)]),v.canDeleteComment(a)?(g(),e("div",re,[t("button",{onClick:e=>v.deleteComment(a.id),class:"btn-delete",title:"Supprimer le commentaire"},u[17]||(u[17]=[t("span",{class:"material-symbols-outlined"},"delete",-1)]),8,ne)])):s("",!0)]),t("p",de,l(a.content),1)]))),128))])):(g(),e("div",me,u[18]||(u[18]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(g(),e("div",ce,[u[19]||(u[19]=t("div",{class:"error-icon"},[t("span",{class:"material-symbols-outlined"},"error")],-1)),u[20]||(u[20]=t("h2",{class:"md3-title-large"},"Astuce introuvable",-1)),u[21]||(u[21]=t("p",{class:"md3-body-large dinor-text-gray"},"L'astuce demandÃ©e n'existe pas ou a Ã©tÃ© supprimÃ©e.",-1)),t("div",ue,[t("button",{onClick:u[5]||(u[5]=(...e)=>v.goBack&&v.goBack(...e)),class:"btn-secondary"},"Retour aux astuces"),t("button",{onClick:u[6]||(u[6]=(...e)=>v.goHome&&v.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(f,{modelValue:v.showShareModal,"onUpdate:modelValue":u[7]||(u[7]=e=>v.showShareModal=e),"share-data":v.shareData},null,8,["modelValue","share-data"]),a(k,{modelValue:v.showAuthModal,"onUpdate:modelValue":u[8]||(u[8]=e=>v.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-3740a13a"]]);export{pe as default};

import{d as e,r as t,b as s,u as a,t as i,v as r,M as l,A as c,x as n,z as o,U as u,B as d,L as p,F as f,y as h,K as v,n as g,p as y,w as m,E as k,o as R}from"./vendor.hA9YLfwd.js";import{b as w,_,D as C,A as F,c as b}from"./index.BcZTeLW-.js";import{B as L,u as A}from"./BannerSection.yWwNkGiU.js";import{S as E}from"./SearchAndFilters.pYUQH8OH.js";import{L as S}from"./LikeButton.atApUSp_.js";import"./useApi.D2XN-DnO.js";const Q=e("recipes",()=>{const e=t([]),a=t(null),i=t(!1),r=t(null),l=t(""),c=t(null),n=t({current_page:1,last_page:1,per_page:12,total:0}),o=s(()=>{let t=e.value;if(l.value){const e=l.value.toLowerCase();t=t.filter(t=>{var s,a;return t.title.toLowerCase().includes(e)||(null==(s=t.short_description)?void 0:s.toLowerCase().includes(e))||(null==(a=t.tags)?void 0:a.some(t=>t.toLowerCase().includes(e)))})}return c.value&&(t=t.filter(e=>e.category_id===c.value)),t}),u=s(()=>e.value.filter(e=>e.is_featured));return{recipes:e,currentRecipe:a,loading:i,error:r,searchQuery:l,selectedCategory:c,pagination:n,filteredRecipes:o,featuredRecipes:u,fetchRecipes:async function(t={}){i.value=!0,r.value=null;try{const s=await w.getRecipes(t);if(!s.success)throw new Error(s.message||"Failed to fetch recipes");e.value=s.data,s.meta&&(n.value=s.meta)}catch(s){r.value=s.message,console.error("Error fetching recipes:",s)}finally{i.value=!1}},fetchRecipesFresh:async function(t={}){i.value=!0,r.value=null;try{console.log("üîÑ [RecipesStore] Rafra√Æchissement forc√© des recettes (cache d√©sactiv√©)");const s=await w.getRecipes(t);if(!s.success)throw new Error(s.message||"Failed to fetch recipes");e.value=s.data,s.meta&&(n.value=s.meta),console.log("‚úÖ [RecipesStore] Recettes rafra√Æchies:",s.data.length)}catch(s){r.value=s.message,console.error("Error fetching recipes:",s)}finally{i.value=!1}},fetchRecipe:async function(e){i.value=!0,r.value=null;try{const t=await w.getRecipe(e);if(!t.success)throw new Error(t.message||"Failed to fetch recipe");a.value=t.data}catch(t){r.value=t.message,console.error("Error fetching recipe:",t)}finally{i.value=!1}},fetchRecipeFresh:async function(e){i.value=!0,r.value=null;try{console.log("üîÑ [RecipesStore] Rafra√Æchissement forc√© de la recette:",e,"(cache d√©sactiv√©)");const t=await w.getRecipe(e);if(!t.success)throw new Error(t.message||"Failed to fetch recipe");a.value=t.data,console.log("‚úÖ [RecipesStore] Recette rafra√Æchie:",t.data.title)}catch(t){r.value=t.message,console.error("Error fetching recipe:",t)}finally{i.value=!1}},toggleLike:async function(t){try{const s=await w.toggleLike("recipes",t);if(s.success){const i=e.value.find(e=>e.id===t);return i&&(i.is_liked=s.data.is_liked,i.likes_count=s.data.likes_count),a.value&&a.value.id===t&&(a.value.is_liked=s.data.is_liked,a.value.likes_count=s.data.likes_count),s.data}}catch(s){return console.error("Error toggling like:",s),{success:!1}}},setSearchQuery:function(e){l.value=e},setSelectedCategory:function(e){c.value=e},clearFilters:function(){l.value="",c.value=null},clearCurrentRecipe:function(){a.value=null},clearError:function(){r.value=null}}}),T={class:"recipes-list"},z={class:"filters-toggle"},q=["disabled"],B={class:"filters-container"},M={key:0,class:"loading-state"},j={key:1,class:"error-state"},D={class:"error-icon"},x={key:2,class:"content"},U={key:0,class:"results-info"},I={key:0},V={key:1,class:"empty-state"},P={class:"empty-icon"},K={key:0},N={key:1},O={key:2,class:"recipes-grid"},W=["onClick"],$={class:"recipe-image"},G=["src","alt"],H={class:"recipe-overlay"},J={class:"recipe-meta"},X={key:0,class:"time"},Y={key:1,class:"difficulty"},Z={class:"recipe-content"},ee={class:"recipe-title"},te={key:0,class:"recipe-description"},se={class:"recipe-stats"},ae={class:"stat"},ie={class:"stat"},re={key:0,class:"stat"},le={key:1,class:"stat equipment"};const ce=_({name:"RecipesList",components:{BannerSection:L,SearchAndFilters:E,LikeButton:S,AuthModal:F,DinorIcon:C},setup(){const e=k(),a=Q(),i=b(),{banners:r,loadBannersForContentType:l}=A(),c=s(()=>r.value),n=t(!1),o=t(!1),u=t([]),d=s({get:()=>a.searchQuery,set:e=>a.setSearchQuery(e)}),p=s({get:()=>a.selectedCategory,set:e=>a.setSelectedCategory(e)}),f=s(()=>a.loading),h=s(()=>a.error),v=t({}),R=s(()=>{var e;let t=a.recipes;if(null==(e=d.value)?void 0:e.trim()){const e=d.value.toLowerCase();t=t.filter(t=>{var s,a,i;return(null==(s=t.title)?void 0:s.toLowerCase().includes(e))||(null==(a=t.short_description)?void 0:a.toLowerCase().includes(e))||(null==(i=t.tags)?void 0:i.some(t=>t.toLowerCase().includes(e)))})}if(p.value&&(t=t.filter(e=>e.category_id===p.value)),v.value.difficulty&&(t=t.filter(e=>e.difficulty===v.value.difficulty)),v.value.prep_time){const e=v.value.prep_time;t=t.filter(t=>{const s=t.preparation_time||0;return"quick"===e?s<30:"medium"===e?s>=30&&s<=60:"long"!==e||s>60})}return t}),_=s(()=>Object.values(v.value).some(e=>null!==e)),C=async(e=!1)=>{e&&(console.log("üîÑ [RecipesList] Rechargement forc√© des recettes"),a.clearCache(),await w.clearCache()),await a.fetchRecipesFresh()},F=e=>{const{type:t,id:s,liked:a,count:i}=e.detail;if("recipe"===t){const e=R.value.find(e=>e.id==s);e&&(e.is_liked=a,e.likes_count=i)}};return g(()=>{C(),(async()=>{try{console.log("üç≥ [RecipesList] Chargement banni√®res pour type: recipes"),await l("recipes",!0)}catch(e){console.error("Error loading banners:",e)}})(),(async()=>{try{const e=await w.getRecipeCategories();e.success&&(u.value=e.data)}catch(e){console.error("Error loading categories:",e)}})(),i.initializePWAListeners(),i.initializeNetworkListeners(),window.addEventListener("like-updated",F)}),y(()=>{window.removeEventListener("like-updated",F)}),m(d,e=>{}),{searchQuery:d,selectedCategory:p,loading:f,error:h,filteredRecipes:R,categories:u,bannersByType:c,selectedFilters:v,recipeFilters:[{key:"difficulty",label:"Difficult√©",icon:"star",allLabel:"Tous niveaux",options:[{value:"easy",label:"Facile"},{value:"medium",label:"Moyen"},{value:"hard",label:"Difficile"}]},{key:"prep_time",label:"Temps de pr√©paration",icon:"schedule",allLabel:"Tous temps",options:[{value:"quick",label:"< 30 min"},{value:"medium",label:"30-60 min"},{value:"long",label:"> 60 min"}]}],hasActiveFilters:_,showFilters:n,goToRecipe:t=>{e.push(`/recipe/${t}`)},clearSearch:()=>{d.value=""},setSelectedCategory:e=>{p.value=e},updateAdditionalFilter:({key:e,value:t})=>{v.value[e]=t},clearAllFilters:()=>{d.value="",p.value=null,v.value={}},retry:()=>{a.clearError(),C()},forceRefresh:async()=>{console.log("üîÑ [RecipesList] Rechargement forc√© demand√©");try{await w.clearCache(),a.clearCache(),await a.fetchRecipesFresh(),console.log("‚úÖ [RecipesList] Rechargement forc√© termin√©")}catch(e){console.error("‚ùå [RecipesList] Erreur lors du rechargement forc√©:",e)}},getDifficultyLabel:e=>({easy:"Facile",medium:"Moyen",hard:"Difficile"}[e]||e),getPreparationTime:e=>e.preparation_time||0,getTotalTime:e=>(e.preparation_time||0)+(e.cooking_time||0)+(e.resting_time||0),showAuthModal:o}}},[["render",function(e,t,s,g,y,m){const k=c("BannerSection"),w=c("DinorIcon"),_=c("SearchAndFilters"),C=c("LikeButton"),F=c("AuthModal");return R(),a("div",T,[i(k,{type:"recipes",section:"hero",banners:g.bannersByType},null,8,["banners"]),r("div",z,[r("button",{onClick:t[0]||(t[0]=e=>g.showFilters=!g.showFilters),class:"toggle-btn"},[i(w,{name:g.showFilters?"expand_less":"expand_more",size:20},null,8,["name"]),r("span",null,n(g.showFilters?"Masquer les filtres":"Afficher les filtres"),1)]),r("button",{onClick:t[1]||(t[1]=(...e)=>g.forceRefresh&&g.forceRefresh(...e)),class:"refresh-btn",title:"Actualiser les donn√©es",disabled:g.loading},[i(w,{name:"refresh",size:20,class:o({spinning:g.loading})},null,8,["class"]),t[9]||(t[9]=r("span",null,"Actualiser",-1))],8,q)]),l(r("div",B,[i(_,{searchQuery:g.searchQuery,"onUpdate:searchQuery":t[2]||(t[2]=e=>g.searchQuery=e),selectedCategory:g.selectedCategory,"onUpdate:selectedCategory":t[3]||(t[3]=e=>g.selectedCategory=e),"search-placeholder":"Rechercher une recette...",categories:g.categories,"additional-filters":g.recipeFilters,"selected-filters":g.selectedFilters,"results-count":g.filteredRecipes.length,"item-type":"recette","onUpdate:additionalFilter":g.updateAdditionalFilter},null,8,["searchQuery","selectedCategory","categories","additional-filters","selected-filters","results-count","onUpdate:additionalFilter"])],512),[[u,g.showFilters]]),g.loading?(R(),a("div",M,t[10]||(t[10]=[r("div",{class:"loading-spinner"},null,-1),r("p",null,"Chargement des recettes...",-1)]))):g.error?(R(),a("div",j,[r("div",D,[i(w,{name:"error",size:32})]),r("p",null,n(g.error),1),r("button",{onClick:t[4]||(t[4]=(...e)=>g.retry&&g.retry(...e)),class:"retry-btn"}," R√©essayer ")])):(R(),a("div",x,[g.filteredRecipes.length?(R(),a("div",U,[p(n(g.filteredRecipes.length)+" recette"+n(g.filteredRecipes.length>1?"s":"")+" ",1),g.searchQuery?(R(),a("span",I,' pour "'+n(g.searchQuery)+'"',1)):d("",!0)])):d("",!0),g.filteredRecipes.length||g.loading?(R(),a("div",O,[(R(!0),a(f,null,h(g.filteredRecipes,e=>{var s;return R(),a("article",{key:e.id,onClick:t=>g.goToRecipe(e.id),class:"recipe-card"},[r("div",$,[r("img",{src:e.featured_image_url||"/images/default-recipe.jpg",alt:e.title,loading:"lazy"},null,8,G),r("div",H,[r("div",J,[g.getTotalTime(e)?(R(),a("span",X,[i(w,{name:"schedule",size:18}),p(" "+n(g.getTotalTime(e))+"min ",1)])):d("",!0),e.difficulty?(R(),a("span",Y,n(g.getDifficultyLabel(e.difficulty)),1)):d("",!0)])])]),r("div",Z,[r("h3",ee,n(e.title),1),e.short_description?(R(),a("p",te,n(e.short_description),1)):d("",!0),r("div",se,[r("div",ae,[i(C,{type:"recipe","item-id":e.id,"initial-liked":e.is_liked||!1,"initial-count":e.likes_count||0,"show-count":!0,size:"small",variant:"minimal",onAuthRequired:t[6]||(t[6]=e=>g.showAuthModal=!0),onClick:t[7]||(t[7]=v(()=>{},["stop"]))},null,8,["item-id","initial-liked","initial-count"])]),r("div",ie,[i(w,{name:"comment",size:18}),r("span",null,n(e.comments_count||0),1)]),e.servings?(R(),a("div",re,[i(w,{name:"group",size:18}),r("span",null,n(e.servings),1)])):d("",!0),(null==(s=e.required_equipment)?void 0:s.length)?(R(),a("div",le,[i(w,{name:"kitchen",size:18}),r("span",null,n(e.required_equipment.length)+" √©quipement"+n(e.required_equipment.length>1?"s":""),1)])):d("",!0)])])],8,W)}),128))])):(R(),a("div",V,[r("div",P,[i(w,{name:"restaurant",size:32})]),r("h3",null,n(g.searchQuery||g.selectedCategory||g.hasActiveFilters?"Aucune recette trouv√©e":"Aucune recette disponible"),1),g.searchQuery||g.selectedCategory||g.hasActiveFilters?(R(),a("p",K," Essayez de modifier vos crit√®res de recherche. ")):(R(),a("p",N," Les recettes seront bient√¥t disponibles. ")),g.searchQuery||g.selectedCategory||g.hasActiveFilters?(R(),a("button",{key:2,onClick:t[5]||(t[5]=(...e)=>g.clearAllFilters&&g.clearAllFilters(...e)),class:"clear-filters-btn"}," Effacer tous les filtres ")):d("",!0)]))])),i(F,{modelValue:g.showAuthModal,"onUpdate:modelValue":t[8]||(t[8]=e=>g.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-cc8f718b"]]);export{ce as default};

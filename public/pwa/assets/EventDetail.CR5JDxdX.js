import{u as e,v as t,t as a,B as n,A as o,x as s,L as l,M as i,O as r,F as d,y as c,r as m,b as u,n as v,E as p,o as g}from"./vendor.hA9YLfwd.js";import{_ as y,D as h,A as f,S as k,u as b,d as C,e as _}from"./index.BcZTeLW-.js";import{u as w}from"./useComments.CVrxHwbm.js";const D={class:"event-detail"},E={class:"md3-main-content"},I={key:0,class:"loading-container"},x={key:1,class:"event-content"},A={key:0,class:"event-hero"},M=["src","alt"],S={class:"event-overlay dinor-gradient-primary"},T={class:"event-badges"},$={key:0,class:"md3-chip event-location"},R={key:1,class:"md3-chip event-category"},L={class:"event-info"},z={class:"event-stats"},N={key:0,class:"stat-item"},j={class:"md3-body-medium"},U={key:1,class:"stat-item"},V={class:"md3-body-medium"},F={key:2,class:"stat-item"},O={class:"md3-body-medium"},G={class:"stat-item"},q={class:"md3-body-medium"},B={class:"stat-item"},H={class:"md3-body-medium"},P={class:"event-details"},Y={class:"detail-item"},Z={class:"md3-body-medium"},J={key:0},K={key:1},Q={key:0},W={key:0,class:"detail-item"},X={class:"md3-body-medium"},ee={class:"location-links"},te={class:"location-buttons"},ae={class:"calendar-links"},ne={class:"calendar-buttons"},oe={key:0,class:"event-description"},se=["innerHTML"],le={key:1,class:"event-registration"},ie={class:"md3-body-medium"},re={key:0,class:"registration-info"},de={class:"md3-body-small dinor-text-gray"},ce={class:"comments-section"},me={class:"md3-title-medium dinor-text-primary"},ue={class:"add-comment-form"},ve={key:0,class:"auth-prompt"},pe={key:1},ge={class:"authenticated-user"},ye={class:"user-info"},he=["disabled"],fe={key:0,class:"comments-list"},ke={class:"comment-header"},be={class:"comment-meta"},Ce={class:"comment-author md3-body-medium"},_e={class:"comment-date md3-body-small dinor-text-gray"},we={key:0,class:"comment-actions"},De=["onClick"],Ee={class:"comment-content md3-body-medium"},Ie={key:1,class:"empty-comments"},xe={key:2,class:"error-state"},Ae={class:"error-icon"},Me={class:"error-actions"};const Se=y({name:"EventDetail",emits:["update-header"],components:{ShareModal:k,AuthModal:f,DinorIcon:h},props:{id:{type:String,required:!0}},setup(e,{emit:t}){const a=p(),n=b(),o=C(),{showShareModal:s,updateOpenGraphTags:l}=_(),{comments:i,loadComments:r,canDeleteComment:d,deleteComment:c,setContext:g,addComment:y}=w(),h=m(null),f=m(!0),k=m(!1),D=m(!1),E=m(""),I=m(!1),x=u(()=>h.value?{title:h.value.title,text:`Ne manquez pas cet Ã©vÃ©nement : ${h.value.title}`,url:window.location.href,image:h.value.image,type:"event",id:h.value.id}:{}),A=async()=>{try{const t=await n.get("/likes/check",{type:"event",id:e.id});k.value=t.success&&t.is_liked}catch(t){console.error("Erreur lors de la vÃ©rification du like:",t)}},M=async()=>{try{const t=await n.get("/favorites/check",{type:"event",id:e.id});D.value=t.success&&t.is_favorited}catch(t){console.error("Erreur lors de la vÃ©rification du favori:",t)}},S=(e,t)=>{if(!e)return"";const a=new Date(e);if(t){const[e,n]=t.split(":");a.setHours(parseInt(e),parseInt(n))}return a.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")};return v(()=>{(async()=>{try{const a=await n.get(`/events/${e.id}`);a.success&&(h.value=a.data,g("Event",e.id),await r(),await A(),await M(),l(x.value),t("update-header",{title:h.value.title||"Ã‰vÃ©nement",showShare:!0,showFavorite:!0,favoriteType:"event",favoriteItemId:parseInt(e.id),isContentFavorited:D.value,backPath:"/events"}))}catch(a){console.error("Erreur lors du chargement de l'Ã©vÃ©nement:",a)}finally{f.value=!1}})()}),{event:h,comments:i,loading:f,userLiked:k,userFavorited:D,newComment:E,toggleLike:async()=>{try{const a=await n.post("/likes/toggle",{likeable_type:"event",likeable_id:e.id});a.success&&(k.value=!k.value,h.value&&(h.value.likes_count=a.data.total_likes),t("update-header",{isLiked:k.value}))}catch(a){console.error("Erreur lors du toggle like:",a)}},toggleFavorite:async()=>{try{const a=await n.post("/favorites/toggle",{favoritable_type:"event",favoritable_id:e.id});a.success&&(D.value=!D.value,h.value&&(h.value.favorites_count=a.data.total_favorites),t("update-header",{isContentFavorited:D.value}))}catch(a){console.error("Erreur lors du toggle favori:",a)}},addComment:async()=>{if(E.value.trim())if(o.isAuthenticated)try{console.log("ðŸ“ [Comments] Envoi du commentaire pour Event:",e.id),await y("Event",e.id,E.value),console.log("âœ… [Comments] Commentaire ajoutÃ© avec succÃ¨s"),E.value=""}catch(t){console.error("âŒ [Comments] Erreur lors de l'ajout du commentaire:",t),(t.message.includes("401")||t.message.includes("connectÃ©"))&&(I.value=!0)}else I.value=!0},canDeleteComment:d,deleteComment:c,goBack:()=>{a.push("/events")},goHome:()=>{a.push("/")},formatEventDate:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"short",day:"numeric",month:"short"}):"",formatEventDateDetailed:e=>e?new Date(e).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",formatTime:e=>{if(!e)return"";if(e.match(/^\d{2}:\d{2}$/))return e;try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return e}},formatCommentDate:e=>{if(!e)return"";const t=new Date,a=new Date(e),n=t-a,o=Math.floor(n/864e5),s=Math.floor(n/36e5),l=Math.floor(n/6e4);return l<1?"Ã€ l'instant":l<60?`Il y a ${l} min`:s<24?`Il y a ${s} h`:o<7?`Il y a ${o} jour${o>1?"s":""}`:a.toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:a.getFullYear()!==t.getFullYear()?"numeric":void 0})},formatDate:e=>e?new Date(e).toLocaleDateString("fr-FR"):"",handleImageError:e=>{e.target.src="/images/default-recipe.jpg"},formatContent:e=>e?"string"==typeof e?e:Array.isArray(e)?e.map((e,t)=>"object"==typeof e&&e.step?`<div class="content-step">\n              <h4>Ã‰tape ${t+1}</h4>\n              <p>${e.step}</p>\n            </div>`:"string"==typeof e?`<div class="content-step">\n              <p>${e}</p>\n            </div>`:`<div class="content-step"><p>${e}</p></div>`).join(""):e.toString():"",showShareModal:s,shareData:x,authStore:o,showAuthModal:I,addToGoogleCalendar:()=>{if(!h.value)return;const e=encodeURIComponent(h.value.title),t=encodeURIComponent(h.value.content?h.value.content.replace(/<[^>]*>/g,""):""),a=encodeURIComponent(h.value.location||""),n=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${e}&dates=${S(h.value.start_date,h.value.start_time)}/${S(h.value.end_date||h.value.start_date,h.value.end_time||h.value.start_time)}&details=${t}&location=${a}&sf=true&output=xml`;window.open(n,"_blank")},addToIcal:()=>{if(!h.value)return;const e=h.value.title,t=h.value.content?h.value.content.replace(/<[^>]*>/g,""):"",a=h.value.location||"",n=S(h.value.start_date,h.value.start_time),o=S(h.value.end_date||h.value.start_date,h.value.end_time||h.value.start_time),s=`BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Dinor//Event//EN\nBEGIN:VEVENT\nUID:${h.value.id}@dinor.com\nDTSTART:${n}\nDTEND:${o}\nSUMMARY:${e}\nDESCRIPTION:${t}\nLOCATION:${a}\nEND:VEVENT\nEND:VCALENDAR`,l=new Blob([s],{type:"text/calendar;charset=utf-8"}),i=URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=`${e.replace(/[^a-zA-Z0-9]/g,"_")}.ics`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)},openInGoogleMaps:()=>{var e;if(!(null==(e=h.value)?void 0:e.location))return;const t=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.value.location)}`;window.open(t,"_blank")},openInAppleMaps:()=>{var e;if(!(null==(e=h.value)?void 0:e.location))return;const t=`https://maps.apple.com/?q=${encodeURIComponent(h.value.location)}`;window.open(t,"_blank")}}}},[["render",function(m,u,v,p,y,h){const f=o("DinorIcon"),k=o("ShareModal"),b=o("AuthModal");return g(),e("div",D,[t("main",E,[p.loading?(g(),e("div",I,u[13]||(u[13]=[t("div",{class:"md3-circular-progress"},null,-1),t("p",{class:"md3-body-large"},"Chargement de l'Ã©vÃ©nement...",-1)]))):p.event?(g(),e("div",x,[p.event.featured_image_url?(g(),e("div",A,[t("img",{src:p.event.featured_image_url||"/images/default-recipe.jpg",alt:p.event.title,class:"event-hero-image",onError:u[0]||(u[0]=(...e)=>p.handleImageError&&p.handleImageError(...e))},null,40,M),t("div",S,[t("div",T,[p.event.location?(g(),e("div",$,[a(f,{name:"location_on",size:16}),t("span",null,s(p.event.location),1)])):n("",!0),p.event.category?(g(),e("div",R,[a(f,{name:"tag",size:16}),t("span",null,s(p.event.category.name),1)])):n("",!0)])])])):n("",!0),t("div",L,[t("div",z,[p.event.start_date?(g(),e("div",N,[a(f,{name:"calendar_today",size:16}),t("span",j,s(p.formatEventDate(p.event.start_date)),1)])):n("",!0),p.event.start_time?(g(),e("div",U,[a(f,{name:"schedule",size:16}),t("span",V,s(p.formatTime(p.event.start_time)),1)])):n("",!0),p.event.location?(g(),e("div",F,[a(f,{name:"place",size:16}),t("span",O,s(p.event.location),1)])):n("",!0),t("div",G,[a(f,{name:"favorite",size:16}),t("span",q,s(p.event.likes_count||0),1)]),t("div",B,[a(f,{name:"comment",size:16}),t("span",H,s(p.event.comments_count||0),1)])]),t("div",P,[t("div",Y,[u[14]||(u[14]=t("h3",{class:"md3-title-small dinor-text-primary"},"Date et Heure",-1)),t("p",Z,[l(s(p.formatEventDateDetailed(p.event.start_date))+" ",1),p.event.start_time?(g(),e("span",J," Ã  "+s(p.formatTime(p.event.start_time)),1)):n("",!0),p.event.end_date&&p.event.end_date!==p.event.start_date?(g(),e("span",K,[l(" - "+s(p.formatEventDateDetailed(p.event.end_date))+" ",1),p.event.end_time?(g(),e("span",Q," Ã  "+s(p.formatTime(p.event.end_time)),1)):n("",!0)])):n("",!0)])]),p.event.location?(g(),e("div",W,[u[18]||(u[18]=t("h3",{class:"md3-title-small dinor-text-primary"},"Lieu",-1)),t("p",X,s(p.event.location),1),t("div",ee,[u[17]||(u[17]=t("h4",{class:"md3-title-small dinor-text-primary"},"Ouvrir dans",-1)),t("div",te,[t("button",{onClick:u[1]||(u[1]=(...e)=>p.openInGoogleMaps&&p.openInGoogleMaps(...e)),class:"location-button google-maps"},[a(f,{name:"map",size:16}),u[15]||(u[15]=l(" Google Maps "))]),t("button",{onClick:u[2]||(u[2]=(...e)=>p.openInAppleMaps&&p.openInAppleMaps(...e)),class:"location-button apple-maps"},[a(f,{name:"navigation",size:16}),u[16]||(u[16]=l(" Apple Maps "))])])])])):n("",!0)]),t("div",ae,[u[21]||(u[21]=t("h3",{class:"md3-title-small dinor-text-primary"},"Ajouter Ã  votre agenda",-1)),t("div",ne,[t("button",{onClick:u[3]||(u[3]=(...e)=>p.addToGoogleCalendar&&p.addToGoogleCalendar(...e)),class:"calendar-button google-calendar"},[a(f,{name:"event",size:16}),u[19]||(u[19]=l(" Google Calendar "))]),t("button",{onClick:u[4]||(u[4]=(...e)=>p.addToIcal&&p.addToIcal(...e)),class:"calendar-button ical"},[a(f,{name:"calendar_month",size:16}),u[20]||(u[20]=l(" iCal / Outlook "))])])]),p.event.content?(g(),e("div",oe,[u[22]||(u[22]=t("h2",{class:"md3-title-medium dinor-text-primary"},"Description",-1)),t("div",{class:"md3-body-large dinor-text-gray",innerHTML:p.formatContent(p.event.content)},null,8,se)])):n("",!0),p.event.registration_required?(g(),e("div",le,[u[24]||(u[24]=t("h3",{class:"md3-title-small dinor-text-primary"},"Inscription",-1)),t("p",ie,[a(f,{name:"info",size:16,class:"dinor-text-secondary"}),u[23]||(u[23]=l(" Inscription requise pour cet Ã©vÃ©nement "))]),p.event.max_attendees?(g(),e("div",re,[t("p",de," Places limitÃ©es: "+s(p.event.max_attendees)+" personnes maximum ",1)])):n("",!0)])):n("",!0),t("div",ce,[t("h2",me,"Commentaires ("+s(p.comments.length)+")",1),t("div",ue,[p.authStore.isAuthenticated?(g(),e("div",pe,[t("div",ge,[t("span",ye,"ConnectÃ© en tant que "+s(p.authStore.userName),1),t("button",{onClick:u[6]||(u[6]=e=>p.authStore.logout()),class:"btn-logout"},"DÃ©connexion")]),i(t("textarea",{"onUpdate:modelValue":u[7]||(u[7]=e=>p.newComment=e),placeholder:"Ajoutez votre commentaire...",class:"md3-textarea",rows:"3"},"                ",512),[[r,p.newComment]]),t("button",{onClick:u[8]||(u[8]=(...e)=>p.addComment&&p.addComment(...e)),class:"btn-primary",disabled:!p.newComment.trim()}," Publier ",8,he)])):(g(),e("div",ve,[u[25]||(u[25]=t("p",{class:"auth-prompt-text"},"Connectez-vous pour laisser un commentaire",-1)),t("button",{onClick:u[5]||(u[5]=e=>p.showAuthModal=!0),class:"btn-primary"}," Se connecter ")]))]),p.comments.length?(g(),e("div",fe,[(g(!0),e(d,null,c(p.comments,o=>(g(),e("div",{key:o.id,class:"comment-item"},[t("div",ke,[t("div",be,[t("span",Ce,s(o.author_name),1),t("span",_e,s(p.formatDate(o.created_at)),1)]),p.canDeleteComment(o)?(g(),e("div",we,[t("button",{onClick:e=>p.deleteComment(o.id),class:"btn-delete",title:"Supprimer le commentaire"},[a(f,{name:"delete",size:16})],8,De)])):n("",!0)]),t("p",Ee,s(o.content),1)]))),128))])):(g(),e("div",Ie,u[26]||(u[26]=[t("p",{class:"md3-body-medium dinor-text-gray"},"Aucun commentaire pour le moment.",-1)])))])])])):(g(),e("div",xe,[t("div",Ae,[a(f,{name:"error",size:64})]),u[27]||(u[27]=t("h2",{class:"md3-title-large"},"Ã‰vÃ©nement introuvable",-1)),u[28]||(u[28]=t("p",{class:"md3-body-large dinor-text-gray"},"L'Ã©vÃ©nement demandÃ© n'existe pas ou a Ã©tÃ© supprimÃ©.",-1)),t("div",Me,[t("button",{onClick:u[9]||(u[9]=(...e)=>p.goBack&&p.goBack(...e)),class:"btn-secondary"},"Retour aux Ã©vÃ©nements"),t("button",{onClick:u[10]||(u[10]=(...e)=>p.goHome&&p.goHome(...e)),class:"btn-primary"},"Accueil")])]))]),a(k,{modelValue:p.showShareModal,"onUpdate:modelValue":u[11]||(u[11]=e=>p.showShareModal=e),"share-data":p.shareData},null,8,["modelValue","share-data"]),a(b,{modelValue:p.showAuthModal,"onUpdate:modelValue":u[12]||(u[12]=e=>p.showAuthModal=e)},null,8,["modelValue"])])}],["__scopeId","data-v-64caa0de"]]);export{Se as default};
